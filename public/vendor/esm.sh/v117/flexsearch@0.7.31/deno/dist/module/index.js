/* esm.sh - esbuild bundle(flexsearch@0.7.31/dist/module) deno production */
import{SUPPORT_ENCODER as a,SUPPORT_CACHE as S,SUPPORT_ASYNC as M,SUPPORT_SUGGESTION as A,SUPPORT_SERIALIZE as N}from"/v117/flexsearch@0.7.31/deno/dist/module/config.js";import"/v117/flexsearch@0.7.31/deno/dist/module/type.js";import{encode as q}from"/v117/flexsearch@0.7.31/deno/dist/module/lang/latin/default.js";import{create_object as x,create_object_array as R,concat as G,sort_by_length_down as D,is_array as H,is_string as j,is_object as E,parse_option as P}from"/v117/flexsearch@0.7.31/deno/dist/module/common.js";import{init_stemmer_or_matcher as T,init_filter as L}from"/v117/flexsearch@0.7.31/deno/dist/module/lang.js";import{global_lang as Y,global_charset as Z}from"/v117/flexsearch@0.7.31/deno/dist/module/global.js";import B from"/v117/flexsearch@0.7.31/deno/dist/module/async.js";import{intersect as F}from"/v117/flexsearch@0.7.31/deno/dist/module/intersect.js";import J,{searchCache as K}from"/v117/flexsearch@0.7.31/deno/dist/module/cache.js";import Q from"/v117/flexsearch@0.7.31/deno/dist/module/preset.js";import{exportIndex as V,importIndex as W}from"/v117/flexsearch@0.7.31/deno/dist/module/serialize.js";function d(t,i){if(!(this instanceof d))return new d(t);let e,s,n;t?(a&&(t=Q(t)),e=t.charset,s=t.lang,j(e)&&(e.indexOf(":")===-1&&(e+=":default"),e=Z[e]),j(s)&&(s=Y[s])):t={};let o,r,l=t.context||{};this.encode=t.encode||e&&e.encode||q,this.register=i||x(),this.resolution=o=t.resolution||9,this.tokenize=n=e&&e.tokenize||t.tokenize||"strict",this.depth=n==="strict"&&l.depth,this.bidirectional=P(l.bidirectional,!0),this.optimize=r=P(t.optimize,!0),this.fastupdate=P(t.fastupdate,!0),this.minlength=t.minlength||1,this.boost=t.boost,this.map=r?R(o):x(),this.resolution_ctx=o=l.resolution||1,this.ctx=r?R(o):x(),this.rtl=e&&e.rtl||t.rtl,this.matcher=(n=t.matcher||s&&s.matcher)&&T(n,!1),this.stemmer=(n=t.stemmer||s&&s.stemmer)&&T(n,!0),this.filter=(n=t.filter||s&&s.filter)&&L(n),S&&(this.cache=(n=t.cache)&&new J(n))}var pt=d;d.prototype.append=function(t,i){return this.add(t,i,!0)},d.prototype.add=function(t,i,e,s){if(i&&(t||t===0)){if(!s&&!e&&this.register[t])return this.update(t,i);i=this.encode(""+i);let n=i.length;if(n){let o=x(),r=x(),l=this.depth,g=this.resolution;for(let c=0;c<n;c++){let f=i[this.rtl?n-1-c:c],h=f.length;if(f&&h>=this.minlength&&(l||!r[f])){let m=k(g,n,c),u="";switch(this.tokenize){case"full":if(2<h){for(let p=0;p<h;p++)for(let _=h;_>p;_--)if(_-p>=this.minlength){let y=k(g,n,c,h,p);u=f.substring(p,_),this.push_index(r,u,y,t,e)}break}case"reverse":if(1<h){for(let p=h-1;0<p;p--)if(u=f[p]+u,u.length>=this.minlength){let _=k(g,n,c,h,p);this.push_index(r,u,_,t,e)}u=""}case"forward":if(1<h){for(let p=0;p<h;p++)u+=f[p],u.length>=this.minlength&&this.push_index(r,u,m,t,e);break}default:if(this.boost&&(m=Math.min(0|m/this.boost(i,f,c),g-1)),this.push_index(r,f,m,t,e),l&&1<n&&c<n-1){let p=x(),_=this.resolution_ctx,y=f,I=Math.min(l+1,n-c);p[y]=1;for(let z=1;z<I;z++)if(f=i[this.rtl?n-1-c-z:c+z],f&&f.length>=this.minlength&&!p[f]){p[f]=1;let w=k(_+(n/2>_?0:1),n,c,I-1,z-1),C=this.bidirectional&&f>y;this.push_index(o,C?y:f,w,t,e,C?f:y)}}}}}this.fastupdate||(this.register[t]=1)}}return this};function k(t,i,e,s,n){return e&&1<t?i+(s||0)<=t?e+(n||0):0|(t-1)/(i+(s||0))*(e+(n||0))+1:0}d.prototype.push_index=function(t,i,e,s,n,o){let r=o?this.ctx:this.map;if((!t[i]||o&&!t[i][o])&&(this.optimize&&(r=r[e]),o?(t=t[i]||(t[i]=x()),t[o]=1,r=r[o]||(r[o]=x())):t[i]=1,r=r[i]||(r[i]=[]),this.optimize||(r=r[e]||(r[e]=[])),(!n||!r.includes(s))&&(r[r.length]=s,this.fastupdate))){let l=this.register[s]||(this.register[s]=[]);l[l.length]=r}},d.prototype.search=function(t,i,e){e||(!i&&E(t)?(e=t,t=e.query):E(i)&&(e=i));let s,n,o,r=[],l=0;if(e&&(t=e.query||t,i=e.limit,l=e.offset||0,n=e.context,o=A&&e.suggest),t&&(t=this.encode(""+t),s=t.length,1<s)){let h=x(),m=[];for(let u,p=0,_=0;p<s;p++)if(u=t[p],u&&u.length>=this.minlength&&!h[u]){if(!this.optimize&&!o&&!this.map[u])return r;m[_++]=u,h[u]=1}t=m,s=t.length}if(!s)return r;i||(i=100);let g,c=this.depth&&1<s&&n!==!1,f=0;c?(g=t[0],f=1):1<s&&t.sort(D);for(let h,m;f<s;f++){if(m=t[f],c?(h=this.add_result(r,o,i,l,s===2,m,g),(!o||h!==!1||!r.length)&&(g=m)):h=this.add_result(r,o,i,l,s===1,m),h)return h;if(o&&f==s-1){let u=r.length;if(!u){if(c){c=0,f=-1;continue}return r}if(u===1)return U(r[0],i,l)}}return F(r,i,l,o)},d.prototype.add_result=function(t,i,e,s,n,o,r){let l=[],g=r?this.ctx:this.map;if(this.optimize||(g=v(g,o,r,this.bidirectional)),g){let c=0,f=Math.min(g.length,r?this.resolution_ctx:this.resolution);for(let h,m,u=0,p=0;u<f&&(h=g[u],!(h&&(this.optimize&&(h=v(h,o,r,this.bidirectional)),s&&h&&n&&(m=h.length,m<=s?(s-=m,h=null):(h=h.slice(s),s=0)),h&&(l[c++]=h,n&&(p+=h.length,p>=e)))));u++);if(c)return n?U(l,e,0):void(t[t.length]=l)}return!i&&l};function U(t,i,e){return t=t.length===1?t[0]:G(t),e||t.length>i?t.slice(e,e+i):t}function v(t,i,e,s){if(e){let n=s&&i>e;t=t[n?i:e],t=t&&t[n?e:i]}else t=t[i];return t}d.prototype.contain=function(t){return!!this.register[t]},d.prototype.update=function(t,i){return this.remove(t).add(t,i)},d.prototype.remove=function(t,i){let e=this.register[t];if(e){if(this.fastupdate)for(let s,n=0;n<e.length;n++)s=e[n],s.splice(s.indexOf(t),1);else O(this.map,t,this.resolution,this.optimize),this.depth&&O(this.ctx,t,this.resolution_ctx,this.optimize);i||delete this.register[t],S&&this.cache&&this.cache.del(t)}return this};function O(t,i,e,s,n){let o=0;if(H(t))if(n){let r=t.indexOf(i);r===-1?o++:1<t.length&&(t.splice(r,1),o++)}else{n=Math.min(t.length,e);for(let r,l=0;l<n;l++)r=t[l],r&&(o=O(r,i,e,s,n),!s&&!o&&delete t[l])}else for(let r in t)o=O(t[r],i,e,s,n),o||delete t[r];return o}S&&(d.prototype.searchCache=K),N&&(d.prototype.export=V,d.prototype.import=W),M&&B(d.prototype);export{pt as default};
//# sourceMappingURL=module.js.map